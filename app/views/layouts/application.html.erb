<!DOCTYPE html>
<html>
  <head>
    <title>MWI University</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  </head>

  <body>
    <!-- Top Navbar -->
    <nav id="top-navbar" class="top-navbar py-1">
      <div class="container d-flex justify-content-center">
        <ul class="nav">
          <li class="nav-item">
            <%= link_to "Departments", departments_path, class: "nav-link #{'active' if current_page?(departments_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Teachers", teachers_path, class: "nav-link #{'active' if current_page?(teachers_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Students", students_path, class: "nav-link #{'active' if current_page?(students_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Sections", sections_path, class: "nav-link #{'active' if current_page?(sections_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Subjects", subjects_path, class: "nav-link #{'active' if current_page?(subjects_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Classlists", classlists_path, class: "nav-link #{'active' if current_page?(classlists_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Staffs", staffs_path, class: "nav-link #{'active' if current_page?(staffs_path)}" %>
          </li>
          <li class="nav-item">
            <%= link_to "Guardians", guardians_path, class: "nav-link #{'active' if current_page?(guardians_path)}" %>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Navbar -->
    <nav id="main-navbar" class="main-navbar navbar navbar-expand-lg">
      <div class="container">
        <a class="navbar-brand d-flex align-items-center brand-purple fw-bold" href="/">
          <%= image_tag "logo.png", alt: "MWI Logo", class: "navbar-logo" %>
          MWI University
        </a>

        <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
          aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="bi bi-list"></span>
        </button>

        <div class="collapse navbar-collapse" id="mainNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item"><%= link_to "Home", root_path, class: "nav-link text-white fw-semibold" %></li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white fw-semibold" href="#" id="admissionsDropdown" role="button" data-bs-toggle="dropdown">Admission</a>
              <ul class="dropdown-menu shadow border-0 rounded-4">
                <li><%= link_to "Departments", departments_path, class: "dropdown-item" %></li>
                <li><%= link_to "Teachers", teachers_path, class: "dropdown-item" %></li>
                <li><%= link_to "Students", students_path, class: "dropdown-item" %></li>
                <li><%= link_to "Guardians", guardians_path, class: "dropdown-item" %></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white fw-semibold" href="#" id="academicsDropdown" role="button" data-bs-toggle="dropdown">Academics</a>
              <ul class="dropdown-menu shadow border-0 rounded-4">
                <li><%= link_to "Sections", sections_path, class: "dropdown-item" %></li>
                <li><%= link_to "Subjects", subjects_path, class: "dropdown-item" %></li>
                <li><%= link_to "Classlists", classlists_path, class: "dropdown-item" %></li>
              </ul>
            </li>

            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white fw-semibold" href="#" id="moreDropdown" role="button" data-bs-toggle="dropdown">More</a>
              <ul class="dropdown-menu shadow border-0 rounded-4">
                <li><%= link_to "Staffs", staffs_path, class: "dropdown-item" %></li>
              </ul>
            </li>
          </ul>

          <form class="d-flex ms-3">
            <input class="form-control form-control-sm rounded-pill me-2 shadow-sm" type="search" placeholder="Search">
            <button class="btn btn-outline-light btn-sm search-circle-btn bi bi-search" type="submit"></button>
          </form>
        </div>
      </div>
    </nav>

    <div class="pt-5 mt-5"></div>
    
    <% flash.each do |key, message| %> 
      <div class="alert alert-<%= key == "notice" ? "success" : "danger" %> alert-dismissible fade show" role="alert"> 
        <%= message %> 
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button> 
      </div> 
    <% end %> 
    
    <%= yield %> 
    <!-- Bootstrap JS CDN (Optional for dropdowns, nav, etc.) --> 
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Ensure this runs both on full loads and Turbo navigation
      function initBootstrapDropdowns() {
        try {
          const toggles = Array.from(document.querySelectorAll('.dropdown-toggle'));
          toggles.forEach(el => {
            // If a Dropdown instance already exists, bootstrap will ignore re-init,
            // but this ensures a fresh instance on Turbo navigations.
            if (!el.__bootstrapDropdown) {
              el.__bootstrapDropdown = new bootstrap.Dropdown(el);
            }
          });
        } catch (err) {
          console.error("Bootstrap dropdown init error:", err);
        }
      }

      // For regular page loads
      document.addEventListener('DOMContentLoaded', initBootstrapDropdowns);

      // For Turbo (hot navigation in Rails)
      document.addEventListener('turbo:load', initBootstrapDropdowns);

      // Optional: also re-run if new nav is injected dynamically
      document.addEventListener('ajaxComplete', initBootstrapDropdowns);
    </script>

      
    <script>
      const topNavbar = document.getElementById("top-navbar");
      const mainNavbar = document.getElementById("main-navbar");

      window.addEventListener("scroll", () => {
        const scrollY = window.pageYOffset;

        if (scrollY <= 0) {
          // At the very top of the page
          topNavbar.style.top = "0"; 
          mainNavbar.classList.remove("scrolled");
        } else {
          // Not at the top → hide top navbar
          topNavbar.style.top = "-60px"; 
          mainNavbar.classList.add("scrolled");
        }
      });
    </script>

    <!-- Footer -->
    <footer class="mt-5 pt-4 pb-3 text-white" style="background-color: #4e0c88">
      <div class="container">

        <div class="row">
          <div class="col-md-4 mb-4">
            <div class="d-flex align-items-center mb-2">
              <%= image_tag "logo_white.png", alt: "MWI Logo", class: "navbar-logo"%>
              <h5 class="fw-bold mb-0">MWI University</h5>
            </div>
            <p class="small mb-0">
              Committed to excellence in education, research, and community service.
            </p>
          </div>

          <div class="col-md-2 mb-3">
            <h6 class="fw-semibold">Admission</h6>
            <ul class="list-unstyled small">
              <li><%= link_to "Departments", departments_path, class: "text-white text-decoration-none" %></li>
              <li><%= link_to "Teachers", teachers_path, class: "text-white text-decoration-none" %></li>
              <li><%= link_to "Students", students_path, class: "text-white text-decoration-none" %></li>
              <li><%= link_to "Guardians", guardians_path, class: "text-white text-decoration-none" %></li>
            </ul>
          </div>

          <div class="col-md-2 mb-3">
            <h6 class="fw-semibold">Academics</h6>
            <ul class="list-unstyled small">
              <li><%= link_to "Sections", sections_path, class: "text-white text-decoration-none" %></li>
              <li><%= link_to "Subjects", subjects_path, class: "text-white text-decoration-none" %></li>
              <li><%= link_to "Classlists", classlists_path, class: "text-white text-decoration-none" %></li>
            </ul>
          </div>

          <div class="col-md-2 mb-3">
            <h6 class="fw-semibold">More</h6>
            <ul class="list-unstyled small">
              <li><%= link_to "Staffs", staffs_path, class: "text-white text-decoration-none" %></li>
            </ul>
          </div>

          <div class="col-md-2 mb-3">
            <h6 class="fw-semibold">Connect</h6>
            <ul class="list-unstyled small">
              <li><a href="#" class="text-white text-decoration-none">Contact Us</a></li>
              <li><a href="#" class="text-white text-decoration-none">Facebook</a></li>
              <li><a href="#" class="text-white text-decoration-none">Twitter</a></li>
              <li><a href="#" class="text-white text-decoration-none">Instagram</a></li>
            </ul>
          </div>
        </div>

        <div class="text-center pt-3 border-top border-secondary small">
          © <%= Time.zone.now.year %> MWI University. All rights reserved.
        </div>
      </div>
    </footer>
  </body>
</html>